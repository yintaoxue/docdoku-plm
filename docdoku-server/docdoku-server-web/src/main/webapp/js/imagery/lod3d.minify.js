$(document).ready(function(){var e=$("#resultLogs");$("#log").toggle(function(){e.text(o())},function(){e.text("")});var l,x;x=new Stats();x.domElement.style.position="absolute";x.domElement.style.bottom="0px";document.body.appendChild(x.domElement);var u,w,q,m;var i=0,g=0;var k=window.innerWidth/2;var j=window.innerHeight/2;var a=new THREE.Vector3(1,0,0).normalize();var b=new THREE.Vector3(0,1,0).normalize();var c=new THREE.Vector3(0,0,1).normalize();s();d();var n=0;var z=0;var p=0;function t(){n++}function h(){z++}function v(A){p+=A}function o(){return z+" parts, "+n+" instances, "+p+" faces"}function s(){l=document.createElement("div");document.body.appendChild(l);w=new THREE.Scene();u=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,50000);u.position.set(0,10,10000);w.add(u);m=new THREE.TrackballControls(u);m.rotateSpeed=4;m.zoomSpeed=5;m.panSpeed=2;m.noZoom=false;m.noPan=false;m.staticMoving=true;m.dynamicDampingFactor=0.3;var F=new THREE.AmbientLight(1052720);w.add(F);var C=new THREE.DirectionalLight(16777215);C.position.set(200,200,1000).normalize();u.add(C);u.add(C.target);var G=new THREE.AxisHelper();G.position.set(-1000,0,0);G.scale.x=G.scale.y=G.scale.z=2;w.add(G);var E=new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,0),50);E.position.set(200,0,400);w.add(E);var H=true;var A=(H)?new THREE.BinaryLoader():new THREE.JSONLoader();var D=new THREE.MeshFaceMaterial();var B=new THREE.Object3D();$.getJSON("obj/structure.json",function(K){var J=K.length;for(var I=0;I<J;I++){(function(){var M=K[I];var L=(H)?M.binaryFilenameMedium:M.binaryFilenameMedium;var N=M.instances;if(L){A.load(L,function(R){h();var Q=R.faces.length;for(var P=0;P<N.length;P++){var O=N[P];var S=new THREE.Mesh(R,D);S.position.set(O.tx*10,O.ty*10,O.tz*10);f(S,O.rx,O.ry,O.rz);S.doubleSided=false;B.add(S);t();v(Q)}},"images")}})()}w.add(B)});q=new THREE.WebGLRenderer();q.setSize(window.innerWidth,window.innerHeight);l.appendChild(q.domElement)}function r(B,C,D){var A=new THREE.Matrix4();A.makeRotationAxis(C.normalize(),D);A.multiplySelf(B.matrix);B.matrix=A;B.rotation.getRotationFromMatrix(B.matrix,B.scale)}function f(D,G,F,E){var C=new THREE.Matrix4();C.makeRotationAxis(a,G);var B=new THREE.Matrix4();B.makeRotationAxis(b,F);var A=new THREE.Matrix4();A.makeRotationAxis(c,E);D.matrix=A.multiplySelf(B).multiplySelf(C);D.rotation.getRotationFromMatrix(D.matrix,D.scale)}function d(){requestAnimationFrame(d);y();m.update();x.update()}function y(){q.render(w,u)}});